## 턴제 전투 시스템
이 프로젝트의 전투 시스템은 TurnFSM + UnitFSM의 이중 상태 머신 구조로 설계되어,
전투 전체 흐름과 개별 유닛의 행동을 독립적이면서도 유기적으로 처리할 수 있도록 구성하였습니다.

### 설계 의도
- 유닛마다 이동, 공격, 스킬, 피격 등 복잡한 상태 전이를 명확하게 분리
- 전투 흐름은 턴 단위로 관리하면서 각 유닛은 자신만의 상태를 가지도록 설계
- 감정 시스템, 패시브, 반격 등 다양한 효과와의 유연한 통합을 고려
### 전투 흐름
1. TurnHandler가 유닛 Speed 스탯 기준으로 턴 순서를 정렬
2. 유닛은 StartTurn()을 통해 턴을 시작하고, 내부에서 TurnStateMachine을 실행
3. 유닛은 Idle → Move → Act(공격/스킬) → Return → EndTurn 흐름을 따라 동작
4. 전투 중 상태에 따라 감정/패시브 발동, 반격 처리 등 자동 실행
### 특이사항
- 반격 시스템 : HitState에서 상대가 근거리일 경우 FSM 전이로 반격 처리
- 패시브 자동 트리거 : IPassiveTurnStartTrigger, IPassiveEmotionStackTrigger 등으로 상태별 자동 발동
### 장점
- 상태 간의 전이가 명확하여 디버깅 및 유지보수가 용이
- 플레이어/적 유닛 모두 동일 구조를 공유하여 재사용성과 확장성이 우수
- 상태 추가/확장 시 기존 흐름 영향 없이 독립적으로 구현 가능
- 감정 시스템과 패시브 시스템을 FSM 안에서 자연스럽게 연결
---

## 패시브 시스템
전투 중 특정 상황(공격, 피격, 감정 변화 등)에 자동으로 반응하는 이벤트 기반 패시브 시스템을 설계하고 구현했습니다.
- PassiveSO를 기반으로 모든 패시브는 ScriptableObject로 관리됩니다.
- IPassiveTrigger 계열 인터페이스를 통해 턴 시작, 감정 변화, 사망 등 다양한 조건에 반응하도록 구조화했습니다.
- 유닛의 감정 상태와 스택에 따라 발동 조건을 분기 처리해 전략적 효과를 부여할 수 있도록 했습니다.
- 새로운 패시브는 코드 수정 없이 확장 가능하며, 디자이너가 에디터에서 직접 설정할 수 있도록 설계했습니다.
 ---
 
 ## 감정 시스템
 
유닛은 전투 중 특정 조건에 따라 **감정 상태(EmotionType)** 를 가지게 되며, 이 감정은 스탯에 영향을 주거나 부작용을 유발합니다.  
감정은 상태머신(FSM) 흐름 안에 자연스럽게 통합되어 있어, **전투 중 전략적인 변수**로 작동합니다.

 ### 💡 감정 종류 및 효과


| 감정 | 효과 |
|------|------|
| Neutral     | 기본 상태 (버프/디버프 없음) |
| Anger       | 공격력 증가 / 일정 확률로 아군 공격 (최대 30%) |
| Depression  | 방어력 감소 / 일정 확률로 무적 상태 (최대 10%) |
| Joy         | 크리티컬 대미지 증가 / 일정 확률로 공격 빗나감 (턴 지날수록 확률 증가) |

## 🛠️ 기술 구성

- `EmotionType` 기반으로 설계된 **`EmotionFactory` 패턴**을 사용하여, 감정 상태에 따른 객체를 생성
- 각 감정은 `BaseEmotion`을 상속받아 **`ApplyEmotionEffect()`**, `OnTakeDamage()`, `OnAttack()` 등 메서드를 통해 전투에 개입
- 감정은 스탯 시스템(`StatManager`) 및 FSM 흐름과 밀접하게 연결되어 **유닛의 행동 결정에 직접적인 영향을 줌**

---

## 재사용 스크롤뷰
이 구조는 모바일/WebGL 타겟 최적화를 고려해 설계되어, 메모리 효율성과 프레임 드랍을 최소화합니다.
대량의 인벤토리 / 스킬 데이터를 효율적으로 출력하기 위해 ReuseScrollview 시스템을 구현하였습니다.
이 시스템은 ScrollRect의 아이템 프리팹을 동적으로 재사용함으로써, 아이템 개수가 많아져도 성능 저하 없이 동작합니다.
  ### 핵심 기능
  - Object Pooling기반 Slot 재사용
  - 가변형 데이터 대응
  - UI 반응성 유지

  ### 적용 예시
  - BaseInventoryUI 및 BaseSkillInventory를 기반으로 각종 인벤토리 UI에 적용
  - RefreshAtSlotUI(), GetSlotByItem() 등 슬롯 단위 갱신 기능 지원
  ### 성능 효과
  - ScrollView 렌더링 비용 절감
  - 메모리 사용량 감소(모바일 / WebGL 빌드)
  - 프레임 드랍 없이 안정적인 UX 제공
 
## 유닛 Controller

이 시스템은 턴 기반 전투에서 유닛의 상태, 스킬, 감정, 애니메이션 등을 통합 관리하기 위해 설계된 구조입니다.  
FSM 기반 구조와 스탯, 상태 이펙트, 감정 시스템이 통합되어 있으며, 플레이어/적 유닛 모두 재사용 가능한 공통 로직을 공유합니다.

### 🔧 구조 개요
| 클래스 | 역할 |
|--------|------|
| `Unit` | 유닛의 스탯, 위치, 상태, 공격 정보 등 전투 공통 데이터 관리 |
| `BaseController<TController, TState>` | FSM 기반 상태 관리, 스탯/이펙트/스킬/애니메이션 초기화 등 핵심 로직 통합 |
| `PlayerUnitController` | 플레이어 유닛 전용 확장 (사운드, 패시브 트리거, 감정 영향 공격 등) |
| `EnemyUnitController` | 적 유닛 전용 FSM 및 AI 로직 별도 구현 (미구현/생략 가능) |

### 🎮 주요 기능 요약
- `StateMachine<T>` 기반으로 Idle, Move, Attack, Hit, Die, Victory 등 **전투 흐름을 상태 기반으로 관리**
- 감정 시스템, 스킬 시스템, 패시브 트리거를 통합하여 **복잡한 상호작용 처리**
- 공격 시 **회피/방어/감정효과/쉴드 처리 포함한 세밀한 피해 계산**
- FSM과 애니메이션, 이벤트 리스너를 연결하여 **모션 기반 전투 연출**
- **TurnFSM**을 활용하여 턴의 흐름을 `Start → Act → End`로 분리하여 처리
### 💡 기술 포인트
- 제네릭 기반 `BaseController<TController, TState>`로 다양한 유닛 확장성 확보
- `StatManager`, `StatusEffectManager`, `Emotion`, `SkillManager` 등 **모듈 단위 컴포넌트 기반 구조**
- `PlayerUnitController` 내에서 `OnTurnStart`, `OnTurnEnd`, `OnAllyDead` 등의 **패시브 트리거 인터페이스** 통합

### 기타 역할  

- 팀 내 다양한 시스템 설계/구현에 관여  
- 공용 유틸리티/헬퍼, 버그 수정, 테스트 코드 작성 등 기술적 지원
- 팀원 코드 리뷰 및 리팩토링 가이드 제시
---
## 🔗 공용 유틸리티 레포지토리  
👉 https://github.com/shimminseok/Unity_Utility
